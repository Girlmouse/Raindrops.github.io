<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, maximum-scale=1.0">
<title>Raindrops — A moment in time</title>
<style>
*{margin:0;padding:0;box-sizing:border-box;}
html,body{width:100%;height:100%;overflow:hidden;}
body{background:#080a0e;display:flex;flex-direction:column;align-items:center;justify-content:center;
min-height:100vh;min-height:100dvh;font-family:'Helvetica Neue',-apple-system,sans-serif;
user-select:none;-webkit-user-select:none;touch-action:none;overflow:hidden;}
canvas{border-radius:12px;cursor:pointer;touch-action:none;box-shadow:0 0 60px rgba(160,170,200,0.06);}
.sub{color:rgba(255,255,255,0.25);font-size:12px;margin-top:10px;letter-spacing:2px;text-align:center;}
</style>
</head>
<body>
<canvas id="g"></canvas>
<p class="sub">RAINDROPS — A moment in time</p>
<script>
// === CONFIG ===
const DROPS_TO_WIN = 30;
const RAIN_INT = 65;
const GLOW_MIN_GAP = 3000;
const GLOW_MAX_GAP = 6000;
const HIT_R = 45;
const DURATION = 240;
const DENSE = 5;

const QUOTES = [
  "Above the clouds, there is always light.",
  "Mountains teach patience to the sky.",
  "The peak was never the point. The climb was.",
  "Be as steady as stone, as free as wind.",
  "Even mountains were once beneath the sea.",
  "The air is thin here. Breathe slowly.",
  "What feels impossible from below looks different from above.",
  "Silence has a sound. This is it.",
  "You climbed this far. Rest now.",
  "The summit is just a place to see how far you've come.",
];

// === AUDIO ===
let actx=null,started=false,rainSrc=null,rainG=null;

function initAudio(){
  if(started)return;try{
  actx=new(window.AudioContext||window.webkitAudioContext)();started=true;
  const sr=actx.sampleRate,len=sr*3;
  // Layer 1: Wind-driven rain (brown noise, mid cutoff)
  const buf1=actx.createBuffer(2,len,sr);
  for(let ch=0;ch<2;ch++){const d=buf1.getChannelData(ch);let last=0;
    for(let i=0;i<len;i++){const w=Math.random()*2-1;d[i]=(last+(0.02*w))/1.02;last=d[i];d[i]*=3.5;}}
  const src1=actx.createBufferSource();src1.buffer=buf1;src1.loop=true;
  const f1=actx.createBiquadFilter();f1.type="lowpass";f1.frequency.value=1400;
  const g1=actx.createGain();g1.gain.value=0.11;
  src1.connect(f1);f1.connect(g1);src1.start();
  // Layer 2: Wind howl (filtered sweep)
  const buf2=actx.createBuffer(2,len,sr);
  for(let ch=0;ch<2;ch++){const d=buf2.getChannelData(ch);
    for(let i=0;i<len;i++)d[i]=(Math.random()*2-1);}
  const src2=actx.createBufferSource();src2.buffer=buf2;src2.loop=true;
  const f2=actx.createBiquadFilter();f2.type="bandpass";f2.frequency.value=600;f2.Q.value=2.0;
  const g2=actx.createGain();g2.gain.value=0.04;
  src2.connect(f2);f2.connect(g2);src2.start();
  // Layer 3: Sharp rain patter on rock
  const buf3=actx.createBuffer(1,len,sr);
  const d3=buf3.getChannelData(0);
  for(let i=0;i<len;i++){d3[i]=Math.random()>0.99?(Math.random()*2-1)*0.4:0;}
  const src3=actx.createBufferSource();src3.buffer=buf3;src3.loop=true;
  const f3=actx.createBiquadFilter();f3.type="highpass";f3.frequency.value=2500;
  const g3=actx.createGain();g3.gain.value=0.05;
  src3.connect(f3);f3.connect(g3);src3.start();
  // Master
  rainG=actx.createGain();rainG.gain.value=1.0;
  g1.connect(rainG);g2.connect(rainG);g3.connect(rainG);
  rainG.connect(actx.destination);
  rainSrc=src1;
  }catch(e){}}

// Bell / singing bowl sound
function chime(){
  if(!actx)return;
  const notes=[523.2,659.2,784,1046.5,1318.5];
  const f=notes[Math.floor(Math.random()*notes.length)];
  // Bell: sine with slow decay
  const o=actx.createOscillator(),g=actx.createGain();
  o.type="sine";o.frequency.value=f;
  g.gain.setValueAtTime(0.14,actx.currentTime);
  g.gain.exponentialRampToValueAtTime(0.02,actx.currentTime+0.8);
  g.gain.exponentialRampToValueAtTime(0.001,actx.currentTime+1.8);
  o.connect(g);g.connect(actx.destination);o.start();o.stop(actx.currentTime+1.8);
  // Metallic overtone
  const o2=actx.createOscillator(),g2=actx.createGain();
  o2.type="sine";o2.frequency.value=f*2.76; // inharmonic for bell character
  g2.gain.setValueAtTime(0.04,actx.currentTime);
  g2.gain.exponentialRampToValueAtTime(0.001,actx.currentTime+0.6);
  o2.connect(g2);g2.connect(actx.destination);o2.start();o2.stop(actx.currentTime+0.6);
  // Sub tone
  const o3=actx.createOscillator(),g3=actx.createGain();
  o3.type="sine";o3.frequency.value=f*0.5;
  g3.gain.setValueAtTime(0.05,actx.currentTime);
  g3.gain.exponentialRampToValueAtTime(0.001,actx.currentTime+1.2);
  o3.connect(g3);g3.connect(actx.destination);o3.start();o3.stop(actx.currentTime+1.2);
}

function playEnd(){
  if(!actx)return;
  if(rainG)rainG.gain.linearRampToValueAtTime(0.05,actx.currentTime+4);
  [261.6,329.6,392,523.2].forEach((f,i)=>{
    const o=actx.createOscillator(),g=actx.createGain();
    o.type="sine";o.frequency.value=f;
    g.gain.setValueAtTime(0,actx.currentTime+i*0.35);
    g.gain.linearRampToValueAtTime(0.05,actx.currentTime+i*0.35+0.7);
    g.gain.exponentialRampToValueAtTime(0.001,actx.currentTime+i*0.35+4.5);
    o.connect(g);g.connect(actx.destination);o.start(actx.currentTime+i*0.35);o.stop(actx.currentTime+i*0.35+4.5);
  });
}

function resetRain(){if(rainG&&actx)rainG.gain.linearRampToValueAtTime(1.0,actx.currentTime+1);}

// === CANVAS ===
const cv=document.getElementById("g"),c=cv.getContext("2d");
function getSize(){
  const mw=Math.min(window.innerWidth*0.98,700);
  const mh=(window.innerHeight||document.documentElement.clientHeight)*0.90;
  let w=mw,h=w/(16/9);if(h>mh){h=mh;w=h*(16/9);}if(w>mw){w=mw;h=w/(16/9);}
  return{w:Math.floor(w),h:Math.floor(h)};
}
function resize(){const{w,h}=getSize();cv.width=w*2;cv.height=h*2;cv.style.width=w+"px";cv.style.height=h+"px";c.setTransform(2,0,0,2,0,0);}
resize();window.addEventListener("resize",resize);

// === MOUNTAINS ===
function buildMountains(w,h){
  const layers=[];
  // Far range — faded, low
  const far=[];
  let fx=0;
  while(fx<w+60){
    const pw=60+Math.random()*100;
    const ph=h*0.15+Math.random()*h*0.15;
    far.push({x:fx,w:pw,h:ph});
    fx+=pw*0.6;
  }
  layers.push({peaks:far,color:"rgba(25,28,40,0.6)",y:h*0.55});

  // Mid range
  const mid=[];
  let mx=0;
  while(mx<w+80){
    const pw=80+Math.random()*120;
    const ph=h*0.2+Math.random()*h*0.2;
    mid.push({x:mx,w:pw,h:ph});
    mx+=pw*0.55;
  }
  layers.push({peaks:mid,color:"rgba(18,20,30,0.8)",y:h*0.6});

  // Near range — tallest, darkest
  const near=[];
  let nx=-30;
  while(nx<w+100){
    const pw=100+Math.random()*140;
    const ph=h*0.3+Math.random()*h*0.25;
    near.push({x:nx,w:pw,h:ph});
    nx+=pw*0.5;
  }
  layers.push({peaks:near,color:"rgba(12,14,22,0.92)",y:h*0.65});

  return layers;
}
let mountains=null;

function drawMountains(w,h,t){
  if(!mountains)mountains=buildMountains(w,h);

  mountains.forEach(layer=>{
    layer.peaks.forEach(pk=>{
      c.fillStyle=layer.color;
      c.beginPath();
      c.moveTo(pk.x,layer.y);
      // Left slope
      c.lineTo(pk.x+pk.w*0.4+Math.random()*0.5,layer.y-pk.h*0.7);
      // Peak
      c.lineTo(pk.x+pk.w*0.5,layer.y-pk.h);
      // Right slope
      c.lineTo(pk.x+pk.w*0.65,layer.y-pk.h*0.6);
      c.lineTo(pk.x+pk.w,layer.y);
      c.closePath();
      c.fill();

      // Snow cap on taller peaks
      if(pk.h>h*0.3){
        c.fillStyle="rgba(180,190,210,0.12)";
        c.beginPath();
        c.moveTo(pk.x+pk.w*0.42,layer.y-pk.h*0.8);
        c.lineTo(pk.x+pk.w*0.5,layer.y-pk.h);
        c.lineTo(pk.x+pk.w*0.58,layer.y-pk.h*0.82);
        c.closePath();
        c.fill();
      }
    });
  });

  // Ground / valley floor
  c.fillStyle="rgba(12,14,22,0.85)";
  c.fillRect(0,h*0.65,w,h*0.35);

  // Fog layers that drift
  for(let i=0;i<3;i++){
    const fogY=h*0.5+i*h*0.1;
    const fogX=Math.sin(t*0.0003+i*2)*30;
    c.save();
    c.globalAlpha=0.08-i*0.02;
    c.fillStyle="rgba(140,150,175,1)";
    c.beginPath();
    c.ellipse(w*0.3+fogX,fogY,w*0.4,15+i*5,0,0,Math.PI*2);
    c.fill();
    c.beginPath();
    c.ellipse(w*0.7-fogX*0.7,fogY+10,w*0.35,12+i*4,0,0,Math.PI*2);
    c.fill();
    c.restore();
  }
}

// === GAME STATE ===
const gs={
  drops:[],catchPs:[],ripples:[],
  score:0,phase:"menu",timeLeft:DURATION,
  lastRain:0,nextGlow:0,
  cloudOff:0,menuPulse:0,
  endT:0,endQuote:"",
  dimAlpha:0,rainFaded:false,rbPs:null,
};

function scheduleGlow(){
  gs.nextGlow=Date.now()+GLOW_MIN_GAP+Math.random()*(GLOW_MAX_GAP-GLOW_MIN_GAP);
}

function mkDrop(w,h,forceGlow){
  const gl=forceGlow||false;
  return{
    x:Math.random()*w,y:-10-Math.random()*50,
    speed:gl?1.0+Math.random()*0.5:3+Math.random()*3,
    length:gl?16+Math.random()*10:3+Math.random()*9,
    opacity:gl?1:0.08+Math.random()*0.18,
    isGlowing:gl,pulsePhase:Math.random()*Math.PI*2,
    width:gl?2.5:0.5+Math.random()*0.7,
    caught:false,fadeOut:1,
    drift:(Math.random()-0.5)*0.5, // more wind on mountain
  };
}

function mkFx(x,y){
  const ps=[];
  for(let i=0;i<14;i++){
    const a=(Math.PI*2*i)/14+Math.random()*0.3,s=2+Math.random()*3;
    ps.push({x,y,vx:Math.cos(a)*s,vy:Math.sin(a)*s-1.5,life:1,size:1.5+Math.random()*3,
      color:Math.random()>0.5?"rgba(200,210,240,":"rgba(170,185,220,"});
  }
  return ps;
}

function mkRip(x,y){return{x,y,radius:3,opacity:0.45,speed:1};}

// === INPUT ===
function getPos(e){
  const r=cv.getBoundingClientRect();
  const sx=(cv.width/2)/r.width,sy=(cv.height/2)/r.height;
  const px=e.touches?e.touches[0].clientX:e.clientX;
  const py=e.touches?e.touches[0].clientY:e.clientY;
  return{x:(px-r.left)*sx,y:(py-r.top)*sy};
}

function tap(e){
  e.preventDefault();initAudio();

  if(gs.phase==="menu"){
    gs.phase="playing";gs.score=0;gs.timeLeft=DURATION;
    gs.drops=[];gs.catchPs=[];gs.ripples=[];
    gs.endT=0;gs.dimAlpha=0;gs.rainFaded=false;gs.rbPs=null;
    mountains=null;scheduleGlow();
    resetRain();lastTick=Date.now();return;
  }

  if(gs.phase==="quote"){
    gs.phase="menu";gs.score=0;mountains=null;
    gs.dimAlpha=0;gs.rainFaded=false;gs.rbPs=null;resetRain();return;
  }

  if(gs.phase!=="playing")return;

  const{x,y}=getPos(e);
  let best=Infinity,bi=-1;
  for(let i=0;i<gs.drops.length;i++){
    const d=gs.drops[i];if(!d.isGlowing||d.caught)continue;
    const dist=Math.hypot(x-d.x,y-d.y);
    if(dist<HIT_R&&dist<best){best=dist;bi=i;}
  }
  if(bi>=0){
    const d=gs.drops[bi];d.caught=true;gs.score++;
    gs.catchPs.push(...mkFx(d.x,d.y));
    gs.ripples.push(mkRip(d.x,d.y));chime();
    if(gs.score>=DROPS_TO_WIN){
      gs.phase="ending";gs.endT=0;
      gs.endQuote=QUOTES[Math.floor(Math.random()*QUOTES.length)];
      playEnd();
    }
  } else {
    gs.ripples.push(mkRip(x,y));
  }
}

cv.addEventListener("click",tap);
cv.addEventListener("touchstart",tap,{passive:false});

// === DRAW DROP ===
function drawDrop(d){
  c.save();
  if(d.isGlowing&&!d.caught){
    d.pulsePhase+=0.04;const p=0.6+Math.sin(d.pulsePhase)*0.4;
    // Silver/ice glow
    const og=c.createRadialGradient(d.x,d.y,0,d.x,d.y,32);
    og.addColorStop(0,`rgba(180,200,230,${0.22*p})`);og.addColorStop(0.4,`rgba(160,180,215,${0.08*p})`);og.addColorStop(1,"rgba(160,180,215,0)");
    c.fillStyle=og;c.beginPath();c.arc(d.x,d.y,32,0,Math.PI*2);c.fill();
    const ig=c.createRadialGradient(d.x,d.y,0,d.x,d.y,12);
    ig.addColorStop(0,`rgba(210,225,245,${0.45*p})`);ig.addColorStop(1,`rgba(180,200,230,${0.12*p})`);
    c.fillStyle=ig;c.beginPath();c.arc(d.x,d.y,12,0,Math.PI*2);c.fill();
    c.strokeStyle=`rgba(210,225,245,${0.8*d.fadeOut})`;c.lineWidth=d.width;c.lineCap="round";
    c.beginPath();c.moveTo(d.x,d.y-d.length/2);c.lineTo(d.x,d.y+d.length/2);c.stroke();
    c.fillStyle=`rgba(255,255,255,${0.85*p*d.fadeOut})`;
    c.beginPath();c.arc(d.x,d.y,2.5,0,Math.PI*2);c.fill();
  } else {
    c.strokeStyle=`rgba(140,150,170,${d.opacity*d.fadeOut})`;c.lineWidth=d.width;c.lineCap="round";
    c.beginPath();c.moveTo(d.x+d.drift*6,d.y-d.length/2);c.lineTo(d.x,d.y+d.length/2);c.stroke();
  }
  c.restore();
}

// === MAIN LOOP ===
let lastTick=Date.now();

function loop(){
  const now=Date.now(),{w:cw,h:ch}=getSize();

  if(gs.phase==="playing"){
    const dt=now-lastTick;
    if(dt>=1000){
      gs.timeLeft=Math.max(0,gs.timeLeft-Math.floor(dt/1000));
      lastTick=now-(dt%1000);
      if(gs.timeLeft<=0){
        gs.phase="ending";gs.endT=0;
        gs.endQuote=QUOTES[Math.floor(Math.random()*QUOTES.length)];
        playEnd();
      }
    }
  }

  // === BG — dark moody sky ===
  const bg=c.createLinearGradient(0,0,0,ch);
  bg.addColorStop(0,"#0a0c14");bg.addColorStop(0.3,"#111318");bg.addColorStop(0.6,"#181c28");bg.addColorStop(1,"#1c1f2e");
  c.fillStyle=bg;c.fillRect(0,0,cw,ch);

  const isActive=gs.phase==="menu"||gs.phase==="playing"||gs.phase==="ending"||gs.phase==="quote";

  if(isActive){
    // Heavy cloud cover
    gs.cloudOff+=0.06;
    c.save();c.globalAlpha=0.2;c.fillStyle="rgba(30,32,45,1)";
    for(let i=0;i<4;i++){
      const cx2=((gs.cloudOff*(0.15+i*0.12)+i*170)%(cw+350))-175;
      c.beginPath();c.ellipse(cx2,12+i*11,120+i*25,16+i*6,0,0,Math.PI*2);c.fill();
    }
    c.restore();

    // Mountains
    drawMountains(cw,ch,now);

    // === RAIN ===
    const canSpawn=gs.phase==="playing"||gs.phase==="ending";
    const isMenu=gs.phase==="menu"||gs.phase==="quote";

    if(canSpawn&&now-gs.lastRain>RAIN_INT){
      for(let i=0;i<DENSE;i++) gs.drops.push(mkDrop(cw,ch,false));
      gs.lastRain=now;
    }
    if(isMenu&&now-gs.lastRain>120){
      for(let i=0;i<2;i++){const d=mkDrop(cw,ch,false);d.opacity=0.04+Math.random()*0.08;gs.drops.push(d);}
      gs.lastRain=now;
    }

    if(gs.phase==="playing"&&now>=gs.nextGlow){
      gs.drops.push(mkDrop(cw,ch,true));
      scheduleGlow();
    }

    if(gs.drops.length>500) gs.drops.splice(0,gs.drops.length-500);

    for(let i=gs.drops.length-1;i>=0;i--){
      const d=gs.drops[i];d.y+=d.speed;d.x+=d.drift;
      if(d.caught){d.fadeOut-=0.08;if(d.fadeOut<=0){gs.drops.splice(i,1);continue;}}
      if(d.y>ch+20){gs.drops.splice(i,1);continue;}
      if((gs.phase==="ending"||gs.phase==="quote")&&d.isGlowing&&!d.caught){
        d.fadeOut-=0.02;if(d.fadeOut<=0){gs.drops.splice(i,1);continue;}
      }
      if(gs.phase==="ending"&&!d.isGlowing){d.opacity*=0.998;d.speed*=0.999;}
      drawDrop(d);
    }

    // Ripples
    for(let i=gs.ripples.length-1;i>=0;i--){
      const r=gs.ripples[i];r.radius+=r.speed;r.opacity-=0.01;
      if(r.opacity<=0){gs.ripples.splice(i,1);continue;}
      c.save();c.strokeStyle=`rgba(180,195,220,${r.opacity})`;c.lineWidth=1;
      c.beginPath();c.arc(r.x,r.y,r.radius,0,Math.PI*2);c.stroke();c.restore();
    }

    // Catch particles
    for(let i=gs.catchPs.length-1;i>=0;i--){
      const p=gs.catchPs[i];p.x+=p.vx;p.y+=p.vy;p.vy+=0.04;p.life-=0.016;
      if(p.life<=0){gs.catchPs.splice(i,1);continue;}
      c.save();c.globalAlpha=p.life;c.fillStyle=p.color+p.life+")";
      c.beginPath();c.arc(p.x,p.y,p.size*p.life,0,Math.PI*2);c.fill();c.restore();
    }
  }

  // === PLAYING UI ===
  if(gs.phase==="playing"){
    const barW=5,barH=ch*0.6,barX=12,barY=(ch-barH)/2;
    const prog=Math.min(gs.score/DROPS_TO_WIN,1);
    c.fillStyle="rgba(255,255,255,0.06)";
    c.beginPath();c.roundRect(barX,barY,barW,barH,3);c.fill();
    if(prog>0){
      const fillH=barH*prog;
      const fg=c.createLinearGradient(0,barY+barH,0,barY+barH-fillH);
      fg.addColorStop(0,"rgba(160,180,220,0.4)");fg.addColorStop(1,"rgba(200,215,245,0.7)");
      c.fillStyle=fg;c.beginPath();c.roundRect(barX,barY+barH-fillH,barW,fillH,3);c.fill();
      c.shadowColor="rgba(160,180,220,0.35)";c.shadowBlur=6;
      c.beginPath();c.roundRect(barX,barY+barH-fillH,barW,fillH,3);c.fill();c.shadowBlur=0;
    }
    c.fillStyle="rgba(255,255,255,0.65)";c.font="600 13px 'Helvetica Neue',sans-serif";
    c.textAlign="center";c.fillText(`${gs.score}`,barX+barW/2,barY+barH+18);
    const m=Math.floor(gs.timeLeft/60),s=gs.timeLeft%60;
    c.fillStyle="rgba(255,255,255,0.5)";c.font="14px 'Helvetica Neue',sans-serif";
    c.textAlign="right";c.fillText(`${m}:${s.toString().padStart(2,"0")}`,cw-15,22);
  }

  // === MENU ===
  if(gs.phase==="menu"){
    gs.menuPulse+=0.018;
    c.fillStyle="rgba(10,12,20,0.45)";c.fillRect(0,ch*0.28,cw,ch*0.42);
    c.fillStyle="rgba(210,220,240,0.9)";c.font="600 32px 'Helvetica Neue',sans-serif";
    c.textAlign="center";c.fillText("raindrops",cw/2,ch/2-22);
    c.fillStyle=`rgba(180,195,225,${0.5+Math.sin(gs.menuPulse)*0.2})`;
    c.font="600 15px 'Helvetica Neue',sans-serif";c.fillText("tap to begin",cw/2,ch/2+10);
    c.fillStyle="rgba(180,195,225,0.4)";c.font="12px 'Helvetica Neue',sans-serif";
    c.fillText("catch the glowing drops",cw/2,ch/2+32);
    c.fillStyle="rgba(180,195,225,0.3)";c.font="11px 'Helvetica Neue',sans-serif";
    c.fillText("mountain",cw/2,ch/2+52);
  }

  // === ENDING — GOLDEN SUNRISE TRANSITION ===
  if(gs.phase==="ending"){
    gs.endT+=0.005;
    const t=Math.min(gs.endT,1);

    if(!gs.rainFaded&&t>0.2){if(rainG&&actx)rainG.gain.linearRampToValueAtTime(0.05,actx.currentTime+4);gs.rainFaded=true;}

    // Interpolate to golden sunrise
    const r1=Math.floor(10+(254-10)*t),g1=Math.floor(12+(252-12)*t),b1=Math.floor(20+(232-20)*t);
    const r2=Math.floor(28+(254-28)*t),g2=Math.floor(31+(240-31)*t),b2=Math.floor(46+(138-46)*t);
    const tbg=c.createLinearGradient(0,0,0,ch);
    tbg.addColorStop(0,`rgb(${r1},${g1},${b1})`);tbg.addColorStop(1,`rgb(${r2},${g2},${b2})`);
    c.fillStyle=tbg;c.fillRect(0,0,cw,ch);

    for(let i=gs.drops.length-1;i>=0;i--){
      const d=gs.drops[i];d.opacity*=0.95;d.speed*=0.98;
      if(d.opacity<0.003){gs.drops.splice(i,1);continue;}
      c.save();c.strokeStyle=`rgba(180,185,200,${d.opacity})`;c.lineWidth=d.width;c.lineCap="round";
      c.beginPath();c.moveTo(d.x,d.y-d.length/2);c.lineTo(d.x,d.y+d.length/2);c.stroke();c.restore();
      d.y+=d.speed;
    }

    if(t>0.3){
      if(!gs.rbPs||gs.rbPs.length===0){
        gs.rbPs=[];
        const cols=["#fef08a","#fde68a","#fbbf24","#f59e0b","#fca5a5","#d8b4fe","#fed7aa"];
        for(let i=0;i<120;i++)gs.rbPs.push({
          x:Math.random()*cw,y:Math.random()*ch,size:3+Math.random()*7,
          color:cols[Math.floor(Math.random()*cols.length)],
          speed:0.2+Math.random()*0.6,wobble:Math.random()*Math.PI*2,
          wobbleSpd:0.01+Math.random()*0.02,opacity:0,
          target:0.3+Math.random()*0.5,shape:Math.random()>0.5?"c":"d",
        });
      }
      const po=(t-0.3)/0.7;
      gs.rbPs.forEach(p=>{
        p.wobble+=p.wobbleSpd;p.y-=p.speed*0.4;p.x+=Math.sin(p.wobble)*0.4;
        if(p.y<-10)p.y=ch+10;
        c.save();c.globalAlpha=p.target*po*0.6;c.fillStyle=p.color;
        if(p.shape==="c"){c.beginPath();c.arc(p.x,p.y,p.size,0,Math.PI*2);c.fill();}
        else{c.translate(p.x,p.y);c.rotate(Math.PI/4);c.fillRect(-p.size/2,-p.size/2,p.size,p.size);}
        c.restore();
      });
    }

    if(t>0.6){
      c.save();c.globalAlpha=Math.min((t-0.6)/0.3,1)*0.5;
      c.fillStyle="rgba(140,100,30,1)";c.font="600 22px 'Helvetica Neue',sans-serif";
      c.textAlign="center";c.fillText("summit",cw/2,ch/2-10);c.restore();
    }

    if(gs.endT>1.3)gs.phase="quote";
  }

  // === QUOTE SCREEN — GOLDEN SUNRISE ===
  if(gs.phase==="quote"){
    const rg=c.createLinearGradient(0,0,0,ch);
    rg.addColorStop(0,"#fefce8");rg.addColorStop(0.3,"#fef08a");rg.addColorStop(0.65,"#fde68a");rg.addColorStop(1,"#fef3c7");
    c.fillStyle=rg;c.fillRect(0,0,cw,ch);

    // Sunrise glow
    const sx=cw*0.5,sy=ch*0.2;
    const sg=c.createRadialGradient(sx,sy,0,sx,sy,120);
    sg.addColorStop(0,"rgba(253,224,71,0.7)");sg.addColorStop(0.3,"rgba(253,224,71,0.3)");sg.addColorStop(1,"rgba(253,224,71,0)");
    c.fillStyle=sg;c.beginPath();c.arc(sx,sy,120,0,Math.PI*2);c.fill();
    c.fillStyle="rgba(255,255,255,0.9)";c.beginPath();c.arc(sx,sy,25,0,Math.PI*2);c.fill();

    // Rainbow arc
    const arcY=ch*1.6,arcR=cw*0.9;
    ["#eab308","#f59e0b","#f97316","#ef4444","#ec4899","#a855f7"].forEach((col,i)=>{
      c.save();c.strokeStyle=col;c.globalAlpha=0.3;c.lineWidth=12;
      c.beginPath();c.arc(cw*0.5,arcY,arcR+i*14,Math.PI+0.15,Math.PI*2-0.15);c.stroke();c.restore();
    });

    // Particles
    if(gs.rbPs)gs.rbPs.forEach(p=>{
      p.wobble+=p.wobbleSpd;p.y-=p.speed*0.25;p.x+=Math.sin(p.wobble)*0.3;
      if(p.opacity<p.target)p.opacity+=0.008;
      if(p.y<-10){p.y=ch+10;p.x=Math.random()*cw;}
      c.save();c.globalAlpha=p.opacity;c.fillStyle=p.color;
      if(p.shape==="c"){c.beginPath();c.arc(p.x,p.y,p.size,0,Math.PI*2);c.fill();}
      else{c.translate(p.x,p.y);c.rotate(Math.PI/4);c.fillRect(-p.size/2,-p.size/2,p.size,p.size);}
      c.restore();
    });

    // Quote
    c.save();
    const words=gs.endQuote.split(" ");
    let lines=[],line="";
    words.forEach(w=>{const test=line?line+" "+w:w;if(test.length>22){lines.push(line);line=w;}else line=test;});
    if(line)lines.push(line);
    const lh=32,qtH=lines.length*lh+36,qtW=cw*0.85,qtX=(cw-qtW)/2,qtY=ch/2-qtH/2-10;
    c.fillStyle="rgba(255,255,255,0.4)";
    c.beginPath();c.roundRect(qtX,qtY,qtW,qtH,14);c.fill();
    c.fillStyle="rgba(100,70,10,0.9)";
    c.font="italic 600 22px 'Helvetica Neue',sans-serif";
    c.textAlign="center";
    lines.forEach((l,i)=>c.fillText(l,cw/2,qtY+28+i*lh));
    c.restore();

    // Tap button
    const btnW=140,btnH=34,btnX=(cw-btnW)/2,btnY=ch-55;
    c.fillStyle="rgba(255,255,255,0.3)";
    c.beginPath();c.roundRect(btnX,btnY,btnW,btnH,17);c.fill();
    c.fillStyle="rgba(100,70,10,0.7)";c.font="600 13px 'Helvetica Neue',sans-serif";
    c.textAlign="center";c.fillText("tap to continue",cw/2,btnY+btnH/2+4);
  }

  requestAnimationFrame(loop);
}

scheduleGlow();
requestAnimationFrame(loop);
</script>
</body>
</html>
